# CONCEPT 39: Cache Hit
# WHY: When cache exists, dependencies are restored instantly.
#      Dramatically speeds up workflows.

name: 39 - Cache Hit Demo

on:
  workflow_dispatch:

jobs:
  first-run-creates-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Create package.json
        run: |
          cat > package.json << 'EOF'
          {
            "name": "cache-hit-demo",
            "version": "1.0.0",
            "dependencies": {
              "lodash": "^4.17.21"
            }
          }
          EOF
      
      - name: Restore or create cache
        id: cache-npm
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: npm-cache-hit-demo-${{ hashFiles('package.json') }}
      
      - name: Show cache status
        run: |
          echo "ðŸ“Š CACHE STATUS:"
          echo "Cache hit: ${{ steps.cache-npm.outputs.cache-hit }}"
          echo ""
          if [ "${{ steps.cache-npm.outputs.cache-hit }}" == "true" ]; then
            echo "âœ… CACHE HIT! Dependencies restored from cache."
            echo "   This is much faster than downloading!"
          else
            echo "âŒ Cache miss - will create cache after install"
          fi
      
      - name: Install dependencies
        run: npm install
      
      - name: Explain cache hit
        run: |
          echo ""
          echo "ðŸŽ¯ CACHE HIT EXPLAINED"
          echo "======================"
          echo ""
          echo "Run this workflow TWICE to see cache hit:"
          echo ""
          echo "1st run: Cache MISS â†’ installs deps â†’ saves cache"
          echo "2nd run: Cache HIT â†’ restores cache â†’ much faster!"
          echo ""
          echo "Cache key: npm-cache-hit-demo-\${{ hashFiles('package.json') }}"
          echo ""
          echo "If package.json changes, key changes â†’ cache miss"
          echo "If package.json same, key same â†’ cache hit"

# ðŸ“Œ HOW TO TEST:
# 1. Run this workflow once (cache miss, creates cache)
# 2. Run again (cache hit, restores cache)
# ðŸ“Œ OBSERVE: Second run is faster (cache hit)
# ðŸ“Œ MCQ TIP: Cache hit = cache-hit output is 'true'
