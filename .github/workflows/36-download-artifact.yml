# CONCEPT 36: Download Artifact
# WHY: Retrieve artifacts uploaded by previous jobs.
#      Essential for multi-job workflows (build â†’ test â†’ deploy).

name: 36 - Download Artifact Demo

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Build something
        run: |
          mkdir -p dist
          echo "Built application v1.0" > dist/app.txt
          echo "Build timestamp: $(date)" >> dist/app.txt
          echo "Random ID: $RANDOM" >> dist/app.txt
          echo "ðŸ“¦ Build complete!"
          cat dist/app.txt
      
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: built-app
          path: dist/

  test:
    needs: build  # Wait for build to complete
    runs-on: ubuntu-latest
    steps:
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: built-app
          path: downloaded-app/
      
      - name: Verify downloaded artifact
        run: |
          echo "ðŸ“¥ Downloaded artifact contents:"
          ls -la downloaded-app/
          echo ""
          echo "ðŸ“„ File content:"
          cat downloaded-app/app.txt
          echo ""
          echo "âœ… Artifact successfully passed from build to test job!"

  deploy:
    needs: test  # Wait for test to complete
    runs-on: ubuntu-latest
    steps:
      - name: Download same artifact
        uses: actions/download-artifact@v4
        with:
          name: built-app
      
      - name: Deploy
        run: |
          echo "ðŸš€ Deploying..."
          cat app.txt
          echo "âœ… Deployed successfully!"

# ðŸ“Œ OBSERVE: Artifact created in 'build' job is used in 'test' and 'deploy'
# ðŸ“Œ OBSERVE: Each job runs on a DIFFERENT runner
# ðŸ“Œ MCQ TIP: Artifacts are the way to share files between jobs
